##
## Velocity Template for DisplayAttributeReleasePage view-state
##
## Velocity context will contain the following properties :
##
## attributeReleaseContext - context holding consentable attributes
## attributeReleaseFlowDescriptor - attribute consent flow descriptor
## attributeDisplayNameFunction - function to display attribute name
## attributeDisplayDescriptionFunction - function to display attribute description
## consentContext - context representing the state of a consent flow
## encoder - HTMLEncoder class
## flowExecutionKey - SWF execution key (this is built into the flowExecutionUrl)
## flowExecutionUrl - form action location
## flowRequestContext - Spring Web Flow RequestContext
## profileRequestContext - OpenSAML profile request context
## request - HttpServletRequest
## response - HttpServletResponse
## rpUIContext - context with SP UI information from the metadata
## environment - Spring Environment object for property resolution
#set ($serviceName = $rpUIContext.serviceName)
#set ($serviceDescription = $rpUIContext.serviceDescription)
#set ($informationURL = $rpUIContext.informationURL)
#set ($privacyStatementURL = $rpUIContext.privacyStatementURL)
#set ($rpOrganizationLogo = $rpUIContext.getLogo())
#set ($rpOrganizationName = $rpUIContext.organizationName)
#set ($replaceDollarWithNewline = true)
##
<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>#springMessageText("idp.attribute-release.title", "Information Release")</title>
        <link rel="stylesheet" type="text/css" href="https://cdn.ncsu.edu/brand-assets/bootstrap/css/bootstrap.min.css">
    	<link rel="stylesheet" type="text/css" href="https://cdn.ncsu.edu/shibboleth/css/style_405.css">
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        <link rel="icon" type="image/x-icon" href="https://www.ncsu.edu/favicon.ico">
    </head>
    <body>
    <a class="sr-only" href="#content">Skip to main content</a>

    <div class="bs-header">
      <div class="container heading-content">
       <header role="banner">
        <div class="row">
          <div class="col-md-7">
            <img class="logo-image" src="#springMessage("idp.logo")" alt="#springMessageText("idp.logo.alt-text", "logo")">
            <h1 class="shib-title">Shibboleth Login Service</h1>
          </div>
          <div class="col-sm-5">
                #if ($serviceName)
                    <h3 class="sr-only">Service Information</h3>
                    <p style="margin-top: 10px;">
                        #springMessageText("idp.attribute-release.serviceNameLabel", "You are about to access the service:")<br>
                        <span class="service_name">$serviceName</span>
                        #if ($rpOrganizationName)
                            #springMessageText("idp.attribute-release.of", "of") <span class="organization_name">$encoder.encodeForHTML($rpOrganizationName)</span>
                        #end
                    </p>
                #end
                #if ($serviceDescription)
                    <p style="margin-top: 10px;">
                        #springMessageText("idp.attribute-release.serviceDescriptionLabel", "Description as provided by this service:")<br>
                        <span class="service_description">$encoder.encodeForHTML($serviceDescription)</span>
                        <br>
                    </p>
                #end
                #if ($informationURL)
                    <p style="margin-top: 10px;">
                        <a href="$informationURL">#springMessageText("idp.attribute-release.informationURLLabel", "Additional information about the service")</a>
                    </p>
                #end
          </div>
        </div>
       </header>
      </div>
    </div>

    <div class="container main-content" id="content">
      <main role="main">
        <h1 class="sr-only">#springMessageText("idp.attribute-release.title", "Information Release")</h1>
        <form action="$flowExecutionUrl" method="post" style="padding:10px" 
              role="form" aria-label="information release form">
                <div class="shib-form">
                    <p class="alert">
                        #springMessageText("idp.attribute-release.confirmationQuestion", "The information above would be shared with the service if you proceed. Do you agree to release this information to the service every time you access it?")
                    </p>
                    <p style="text-align: center; margin-top: 10px;">
                        <input class="btn btn-red" type="submit" name="_eventId_AttributeReleaseRejected" value="#springMessageText("idp.attribute-release.reject", "Reject")" style="margin-right: 30px;">
                        <input class="btn btn-red" type="submit" name="_eventId_proceed" value="#springMessageText("idp.attribute-release.accept", "Accept")">
                    </p>
                </div>
                <div id="attributeRelease">
                    <table class="table table-striped table-responsive">
                        <thead>
                            <tr>
## changed this from 3 to 2, see hidden attributes below
                                <th colspan="2">
                                    #springMessageText("idp.attribute-release.attributesHeader", "Information to be Provided to Service")
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            #foreach ($attribute in $attributeReleaseContext.getConsentableAttributes().values())
                                <tr>
                                    <td>$encoder.encodeForHTML($attributeDisplayNameFunction.apply($attribute))</td>
                                    <td>
                                        #foreach ($value in $attribute.values)
                                            #if ($replaceDollarWithNewline)
                                                #set ($encodedValue = $encoder.encodeForHTML($value.getDisplayValue()).replaceAll($encoder.encodeForHTML("$"),"<br>"))
                                            #else
                                                #set ($encodedValue = $encoder.encodeForHTML($value.getDisplayValue()))
                                            #end
##                                            #if ($attributeReleaseFlowDescriptor.perAttributeConsentEnabled)
##                                                <label for="$attribute.id"><strong>$encodedValue</strong></label>
##                                            #else
                                                <strong>$encodedValue</strong>
##                                            #end
                                            <br>
                                        #end
## removing third column of hidden attributes, 
## placing those into second column
##                                    </td>
##                                    <td>
##                                        #if ($attributeReleaseFlowDescriptor.perAttributeConsentEnabled)
##                                            #set ($inputType = "checkbox")
##                                        #else
                                            #set ($inputType = "hidden")
##                                        #end
                                        <input id="$attribute.id" type="$inputType" name="_shib_idp_consentIds" value="$encoder.encodeForHTML($attribute.id)" checked>
                                    </td>
                                </tr>
                            #end
                        </tbody>
                    </table>
                </div>
                #if ($privacyStatementURL)
                    <p style="margin-top: 10px;">
                        <a href="$privacyStatementURL">#springMessageText("idp.attribute-release.privacyStatementURLLabel", "Data privacy information of the service")</a>
                    </p>
                #end
##                <div style="float:left;">
##                    <p>
##                        #springMessageText("idp.attribute-release.confirmationQuestion", "The information above would be shared with the service if you proceed. Do you agree to release this information to the service every time you access it?")
##                    </p>
##                    #if ($attributeReleaseFlowDescriptor.doNotRememberConsentAllowed || $attributeReleaseFlowDescriptor.globalConsentAllowed)
##                        <div id="generalConsentDiv" style="display: block; background-color: #F6F6F6;border: 1px gray solid; padding: 10px; width: 92%;">
##                        #springMessageText("idp.attribute-release.consentMethod", "Select an information release consent duration:")
##                    #end
##                    #if ($attributeReleaseFlowDescriptor.doNotRememberConsentAllowed)
##                        <dl>
##                          <dt class="release"><label class="radio">
##                            <input id="_shib_idp_doNotRememberConsent" type="radio" name="_shib_idp_consentOptions" value="_shib_idp_doNotRememberConsent">
##                            #springMessageText("idp.attribute-release.doNotRememberConsent", "Ask me again at next login")
##                          </label></dt>
##                          <dd class="release">
##                            #springMessageText("idp.attribute-release.doNotRememberConsentItem", "I agree to send my information this time.")</li>
##                          </dd>
##                        </dl>
##                    #end
##                    #if ($attributeReleaseFlowDescriptor.doNotRememberConsentAllowed || $attributeReleaseFlowDescriptor.globalConsentAllowed)
##                        <dl>
##                          <dt class="release"><label class="radio">
##                            <input id="_shib_idp_rememberConsent" type="radio" name="_shib_idp_consentOptions" value="_shib_idp_rememberConsent" checked>
##                            #springMessageText("idp.attribute-release.rememberConsent", "Ask me again if information changes")
##                          </label></dt>
##                          <dd class="release">
##                            #springMessageText("idp.attribute-release.rememberConsentItem", "I agree that the same information will be sent automatically to this service in the future.")
##                          </dd>
##                        </dl>
##                    #end
##                    #if ($attributeReleaseFlowDescriptor.globalConsentAllowed)
##                        <dl>
##                          <dt class="release"><label class="radio">
##                            <input id="_shib_idp_globalConsent" type="radio" name="_shib_idp_consentOptions" value="_shib_idp_globalConsent">
##                            #springMessageText("idp.attribute-release.globalConsent", "Do not ask me again")
##                          </label></dt>
##                          <dd class="release">
##                                #springMessageText("idp.attribute-release.globalConsentItem", "I agree that <strong>all</strong> of my information will be released to <strong>any</strong> service.")
##                          </dd>
##                        </dl>
##                    #end
##                    #if ($attributeReleaseFlowDescriptor.doNotRememberConsentAllowed || $attributeReleaseFlowDescriptor.globalConsentAllowed)
##                        #springMessageText("idp.attribute-release.consentMethodRevoke", "This setting can be revoked at any time with the checkbox on the login page.")
##                        </div>
##                    #end

    ## Instead of the form, just use this default always
    <input id="_shib_idp_rememberConsent" type="hidden" name="_shib_idp_consentOptions" value="_shib_idp_rememberConsent">

## moved the buttons to top box
##
##                <div style="float:left;">
##                    <p style="text-align: center; margin-top: 10px;">
##                        <input type="submit" name="_eventId_AttributeReleaseRejected" value="#springMessageText("idp.attribute-release.reject", "Reject")" style="margin-right: 30px;">
##                        <input type="submit" name="_eventId_proceed" value="#springMessageText("idp.attribute-release.accept", "Accept")">
##                    </p>
##                </div>

        </form>
       </main>
     </div>

    <footer class="container" role="contentinfo">
      <div class="group page-footer">
        <div class="row">
          <div class="col-md-12">
            <div class="shib-footer">
              #springMessageText("idp.footer", "Insert your footer text here.")
            </div>
          </div>
        </div>
      </div>
    </footer>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script type='text/javascript' src='//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js'></script>
    <!-- Include all compiled plugins (below) -->
	<script type='text/javascript' src='https://cdn.ncsu.edu/brand-assets/bootstrap/js/bootstrap.min.js'></script>

</body>
</html>
